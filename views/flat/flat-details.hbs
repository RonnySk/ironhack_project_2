<section>
    <h1 class="profile-header">
        {{#if userFromSession.ImgUrl}}
            <a href="/flat"><img src="{{userFromSession.ImgUrl}}" alt="" width="120" height="120" /></a>
        {{/if}}
        Welcome, {{userFromSession.name}} {{#if userIsAdmin}}<span class="is-admin">ADMIN</span>{{/if}}
    </h1>
    <div class="card">
        {{#if hasOverdueTasks}}
            <p>
                <span style="text-transform: uppercase">{{userFromSession.name}}</span>! ‚òùÔ∏è It‚Äôs Saturday and you haven‚Äôt completed your tasks yet. That‚Äôs really bad (we‚Äôre not angry, we‚Äôre just disappointed). Do it soon or this baby animal is going to be very sad:
            </p>
            <img src="/images/sad-kitten.jpg" width="200" />
        {{else}}
            <p>
                Hey {{userFromSession.name}},
            </p>
            <p>
                great job this week ‚Äì you‚Äôre not behind on any tasks (yet).<br>
                So how about some fun reading instead?
            </p>
            <p>
                Did you know about these <a href="https://www.mollymaid.com/practically-spotless/2016/march/ultimate-q-tips-cleaning-tips/">5 great cleaning tipps involving Q-tips?</a><br>
                Fascinating, right? Let that flat sparkle! ‚ú®
            </p>
        {{/if}}
    </div>
</section>
<section>
    <h2 class="edit-mode-hidden">Your current flat:</h2>
    {{#if flat}}
        <p class="edit-mode-hidden">{{flat.name}}</p>
        <form class="edit-mode-show" action="/flat/{{flat._id}}/update" method="post">
            <h2>New flatname:</h2>
            <input type="text" name="name" value="{{flat.name}}" required>
            <button>Update flatname</button>
        </form>
        <form class="edit-mode-show delete-flat" action="/flat/{{flat._id}}/delete" method="post">
            <button type="submit" class="btn btn-edit btn-delete-flat">delete flat</button>
        </form>
        <a class="edit-mode-hidden" href="/flat">üëâ see all your flats</a>
    {{else}}
        <p>You are currently in no flat</p>
    {{/if}}
</section>
{{#if flat}}
<section class="edit-mode-show">
    <h2>Assign new flat admin:</h2>
    <form action="/flat/{{flat._id}}/update/owner/{{userFromSession.id}}" method="post">
        <select name="flatMembers" required>
            <option value="placeholder" disabled selected hidden>select person</option>
            {{#each flat.users}}
                <option value="{{id}}">{{username}}</option>
            {{/each}}
        </select>
        <button type="submit" class="btn">update admin</button>
    </form>
</section>
{{/if}}
<section>
    <h2>Your flatmates:</h2>
        <ul class="list-flatmates unstyled">
           {{#each flat.users}}
                <li>
                    <figure class="user">
                        {{#if ImgUrl}}
                            <img src="{{ImgUrl}}" alt="{{username}}" />
                        {{else}}
                            <img src="/images/sad-puppy.jpg" alt="{{username}}" />
                        {{/if}}
                        <figcaption class="name">{{username}}</figcaption>
                    </figure>
                    <form class="edit-mode-show delete-flatmate" action="/flat/{{../flat._id}}/user/{{_id}}/delete" method="post">
                        <button type="submit" class="btn btn-edit btn-delete-flatmate">delete flatmate</button>
                    </form>
                </li>
            {{/each}}
            <li class="edit-mode-show"><a href="/flat/{{flat._id}}/add-flatmate" class="btn btn-add-flatmate">add flatmate</a></li>
        </ul>
</section>
<section>
    <h2>This week‚Äôs tasks:</h2>
    {{#if updatedTasks}}
        <ul class="list-tasks">
            {{#each updatedTasks}}
                <li>
                    <figure class="user">
                        {{#if user.ImgUrl}}
                            <img src="{{user.ImgUrl}}" alt="{{username}}" />
                        {{else}}
                            <img src="/images/sad-mini-pig.jpg" alt="{{username}}" />
                        {{/if}}
                        <figcaption class="name">{{this.user.username}}</figcaption>
                    </figure>
                    <p class="task">
                        <strong>{{this.name}}</strong><br>
                        <small>{{this.description}}</small>
                     </p>
                    <form class="edit-mode-show delete-task" action="/flat/{{../flat._id}}/task/{{_id}}/delete" method="post">
                        <button type="submit" class="btn btn-edit">delete task</button>
                    </form>
                    <div class="status">
                        {{#if isOwner}}
                                <form action="/flat/{{../flat._id}}/task/{{_id}}/update" method="post">
                                {{#if this.isDone}}
                                    <button class="btn btn-update-task">‚úÖ</button>
                                {{else}}
                                    <button class="btn btn-update-task">üî≤</button>
                                {{/if}}
                            </form>
                        {{else}}
                            {{#if this.isDone}}
                                <div class="task-status">‚úÖ</div>
                            {{else}}
                                <div class="task-status">üî≤</div>
                            {{/if}}
                        {{/if}}
                    </div>
                </li>
            {{/each}} 
        </ul>
    {{else}}
        <p>No tasks yet.</p>
    {{/if}}
</section>
<section class="add-task">
    <h2>Add task</h2>
    <form action="/flat/{{flat._id}}" method="post">
        <input type="text" name="taskname" value="" placeholder="Name" required>
        <input type="text" name="taskdescription" value="" placeholder="Description">
        <select name="taskuser" required>
            <option value="{{flat.owner._id}}" selected hidden>assign to flatmate</option>
            {{#each flat.users}}
                <option value="{{id}}">{{username}}</option>
            {{/each}}
        </select>
        <button>add task</button>
    </form>
</section>